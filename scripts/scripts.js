"use strict";function slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var config={apiKey:"AIzaSyBL9UCwkTeWzbPazNed-bkPQpx1_imxz84",authDomain:"graphical-reasoner.firebaseapp.com",databaseURL:"https://graphical-reasoner.firebaseio.com",storageBucket:"graphical-reasoner.appspot.com"};firebase.initializeApp(config),angular.module("atheistengineergithubioApp",["ngAnimate","ngtweet","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngVis","ui.bootstrap","xeditable","firebase"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/twitter",{templateUrl:"views/twitter.html",controller:"TwitterCtrl",controllerAs:"twitter"}).when("/reason",{templateUrl:"views/reason.html",controller:"ReasonCtrl",controllerAs:"reason",reloadOnSearch:!1,resolve:{currentAuth:["Auth",function(e){return e.$waitForSignIn()}]}}).otherwise({redirectTo:"/"})}]).run(["editableOptions",function(e){e.theme="bs3"}]),angular.module("atheistengineergithubioApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("atheistengineergithubioApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("atheistengineergithubioApp").controller("TwitterCtrl",["$scope","$routeParams",function(e,r){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],e.timelines={me:["My Tweets","737369040692367360"],celebrities:["Atheist Celebrities","737415513077362688"],evolution:["Evolution","737416906966204416"],organizations:["Organizations","737415726059917316"],podcasts:["Smart Podcasts","737412950714134528"],space:["Space Content","737415216791707648"],"science-deniers":["Science Deniers","737409885277683716"],scientists:["Scientists","737412701144666112"]};var t=r.ref;void 0===e.timelines[t]&&(t="me"),e.timeline_id=e.timelines[t][1],e.isActive=function(e){return e===t}}]),angular.module("atheistengineergithubioApp").controller("ReasonCtrl",["$scope","$routeParams","$location","$firebaseArray","$firebaseObject","Auth","Reason","ReasonList","VisDataSet","Firebase",function(e,r,t,n,o,a,s,i,d,l){function g(){alert("This feature isn't yet implemented. Sorry!")}function u(){var r=t.search().name;void 0!==r?(e.unbindGraph(),h(r)):(e.unbindGraph(),e.graph=null)}function c(r){var t=e.graph;return null===e.firebaseUser||void 0===t?(e.graphEditable=!1,!1):(void 0===r&&(r=e.firebaseUser.uid),void 0===t.collaborators&&(t.collaborators=[]),e.graphEditable=r===t.owner||t.collaborators.indexOf(r)>=0,e.graphEditable)}function h(r){var t=s(r,e.auth.uid);return t.then(function(r){e.graph=r,r.$bindTo(e,"graph").then(function(r){e.unbindGraph=r}),c()?e.graphEditable=!0:e.graphEditable=!1,r.$loaded().then(function(e){console.log("Loaded: ",e),void 0!==e.nodes&&(f.clear(),f.add(e.nodes)),void 0!==e.edges&&(b.clear(),b.add(e.edges))}),f.on("*",function(){e.graph.nodes=f.get()}),b.on("*",function(){e.graph.edges=b.get()})}),t}function p(r,n){if(void 0===r.nodes&&(r.nodes=[]),e.selectedNodes=r.nodes,e.selectedNodeObjects=e.graphData.nodes.get(r.nodes),void 0===r.edges&&(r.edges=[]),e.selectedEdges=r.edges,e.selectedEdgeObjects=e.graphData.edges.get(r.edges),t.search({name:e.graph.name,edge:r.edges,node:r.nodes}),r.edges.length>0&&(e.supportedNode=e.graphData.nodes.get(r.edges[0].to),e.supportingNode=e.graphData.nodes.get(r.edges[0].from)),r.nodes.length>0){var o=e.graphData.edges.get({filter:function(e){return r.nodes.indexOf(e.to.toString())>=0}}),a=$.map(o,function(e){return e.from});e.supportingNodes=e.graphData.nodes.get(a);var s=e.graphData.edges.get({filter:function(e){return r.nodes.indexOf(e.from.toString())>=0}}),i=$.map(s,function(e){return e.to});e.supportedNodes=e.graphData.nodes.get(i)}else e.supportedNodes=[],e.supportingNodes=[];n!==!0&&e.$apply()}e.auth=a,e.firebaseUser=null,e.graph=null,e.unbindGraph=function(){},e.downloadGraph=g,e.uploadGraph=g,e.newGraph=function(){e.unbindGraph(),e.graphData.nodes.clear(),e.graphData.edges.clear(),e.graph=null},e.$on("$routeUpdate",u),u();var f=new d,b=new d;e.graphData={nodes:f,edges:b},e.reasons=i(),e.graphEditable=!1,e.copyGraph=function(){e.unbindGraph();var r={owner:e.firebaseUser.uid,nodes:e.graph.nodes,edges:e.graph.edges,name:e.graph.name+" (copy)"};h(r.name).then(function(t){t.owner=e.firebaseUser.uid,t.nodes=r.nodes,t.edges=r.edges})};e.$watch("graph.owner",function(r){void 0!==r&&(e.owner=o(firebase.database().ref("users").child(r)))}),e.setSlug=function(r){e.graph.slug||e.graph.name||h(r),e.graph.slug=r.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),t.search({reason:e.graph.name})},e.twitterSearchUrl=function(){t.search();return"https://twitter.com/search?q="+encodeURI(t.url())},e.auth.$onAuthStateChanged(function(r){e.firebaseUser=r}),e.graphOptions={interaction:{selectConnectedEdges:!1,hover:!1},nodes:{shape:"box"},height:"400px"},e.selectedNodes=[],e.selectedEdges=[],e.supportingNodes=[],e.supportedNodes=[],e.selectedNodeObjects=[],e.supportingNode=[],e.supportedNode=[],e.search=function(e){q2=t.search(),q2.nodes=e.nodes,q2.edges=e.edges,t.search(q2)},e.removeEdge=function(r){e.graphData.edges.remove(r.id),p({nodes:[],edges:[]},!0)},e.removeNode=function(r){e.graphData.nodes.remove(r.id);var t=e.graphData.edges.get({filter:function(e){return e.to===r.id||e.from===r.id}});e.graphData.edges.remove(t),p({nodes:[],edges:[]},!0)},e.createNode=function(){if(e.graphEditable){var r=e.graphData.nodes.add({label:"New Node"});e.select({node:r})}else console.log("Attempt to add node to read-only graph")},e.createEdge=function(r,t){var n=e.graphData.edges.add({arrows:"to",from:r.id,to:t.id});return e.showEdgeTarget=!1,n},e.showEdgeTarget=!1,e.toggleEdgeTarget=function(){e.showEdgeTarget=!e.showEdgeTarget},e.showEdgeFrom=!1,e.toggleEdgeFrom=function(){e.showEdgeFrom=!e.showEdgeFrom},e.select=function(e){void 0===e.edge&&void 0!==e.node?p({nodes:[e.node],edges:[]},!0):void 0!==e.edge&&void 0===e.node?p({nodes:[],edges:[e.edge]},!0):console.log("Illlegal selection call. Only node or edge may be defined.",e)},e.events={click:p}}]),angular.module("atheistengineergithubioApp").controller("HeaderCtrl",["$scope","$location",function(e,r){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],e.isActive=function(e){return e===r.path()}}]),angular.module("atheistengineergithubioApp").factory("ReasonFactory",["$firebaseObject","$q",function(e,r){var t=null,n=null;return e.$extend({getOwnerProfile:function(r){if(void 0!==this.owner){if(this.owner!==t);else{var o=firebase.database().ref("users").child(this.owner);n=e(o)}return n}},isEditable:function(){if(void 0!==this.owner){var e=null!==firebase.auth().currentUser&&this.owner===firebase.auth().currentUser.uid;return console.log("editable:",e,firebase.auth().currentUser.uid,this.owner,this),e}}})}]).factory("Reason",["ReasonFactory","$q",function(e,r){return function(t){var n=slugify(t),o=firebase.database().ref("reasons"),a=r.defer(),s=o.orderByChild("slug").equalTo(n).limitToFirst(1);return s.once("value",function(r){if(r.exists())console.log("Value Exists",r),r.forEach(function(r){var t=e(r.ref);a.resolve(t)});else{console.log("No Value");var s=firebase.auth().currentUser.uid;void 0===s?console.log("Unknown User."):console.log("Logged in as "+s);var i=o.push();i.set({name:t,slug:n,owner:s,created:(new Date).toString()}),a.resolve(e(i))}}),a.promise}}]).factory("ReasonList",["$firebaseObject","$firebaseArray",function(e,r){return function(r){var t="reasons",n=firebase.database().ref(t);return e(n)}}]),angular.module("atheistengineergithubioApp").factory("Auth",["$firebaseAuth","FUser",function(e,r){var t=e();return t.$onAuthStateChanged(function(e){r(e)}),t}]).factory("FUser",["$firebaseObject",function(e){return function(r){if(null===r)return null;var t=firebase.database().ref().child("users"),n=t.child(r.uid);return n.set({displayName:r.displayName,photoUrl:r.photoURL,lastLogin:{".sv":"timestamp"}}),e(n)}}]);